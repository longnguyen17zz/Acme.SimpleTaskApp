@model Acme.SimpleTaskApp.Web.Models.Carts.CartViewModel

@{
    ViewData["Title"] = "Giỏ hàng";
    decimal totalPrice = Model?.Items?.Sum(x => x.Price * x.Quantity) ?? 0;
}

@section scripts
{
    <environment names="Development">
        <script src="~/view-resources/Views/Carts/Index.js" asp-append-version="true"></script>
    </environment>

    <environment names="Staging,Production">
        <script src="~/view-resources/Views/Carts/Index.min.js" asp-append-version="true"></script>
    </environment>
}
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="bg-light py-3">
        <div class="container">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item">
                    <a href="/Homepage" class="text-secondary">
                        <i class="fas fa-home mr-1"></i>Trang chủ
                    </a>
                </li>
                <li class="breadcrumb-item">
                    <a href="#" class="text-primary">Giỏ hàng</a>
                </li>
            </ol>
        </div>
    </nav>
    <!-- Checkout Steps -->
    <div class="bg-white shadow-sm py-4">
        <div class="container">
            <div class="row justify-content-center text-center">
                <div class="col-4">
                    <div class="rounded-circle border border-primary d-flex align-items-center justify-content-center mx-auto mb-2" style="width: 40px; height: 40px; background: #3b82f6;">
                        <span class="text-white font-weight-bold">1</span>
                    </div>
                    <div class="small font-weight-bold">Giỏ hàng</div>
                </div>
                <div class="col-4">
                    <div class="rounded-circle border border-secondary d-flex align-items-center justify-content-center mx-auto mb-2" style="width: 40px; height: 40px;background: gray;">
                        <span class="text-white font-weight-bold">2</span>
                    </div>
                    <div class="small font-weight-bold">Thanh toán</div>
                </div>
                <div class="col-4">
                    <div class="rounded-circle border border-secondary d-flex align-items-center justify-content-center mx-auto mb-2" style="width: 40px; height: 40px; background: gray;">
                        <span class="text-white  font-weight-bold">3</span>
                    </div>
                    <div class="small font-weight-bold">Hoàn tất</div>
                </div>
            </div>
        </div>
    </div>
<form asp-action="Index" asp-controller="Checkouts" class="container mt-5" id="cart-container">
    @* <h2 class="mb-4">🛒 Giỏ hàng của bạn</h2> *@

    @if (Model.Items == null || !Model.Items.Any())
    {
        <div class="alert alert-info">Giỏ hàng của bạn đang trống.</div>
    }
    else
    {
        <table class="table table-bordered">
            <thead class="thead-light">
                <tr>
                     <th class="text-center">
                        <input type="checkbox" id="select-all" />
                    </th>
                    <th class="text-center">Hình ảnh</th>
                    <th class="text-center">Sản phẩm</th>
                    <th class="text-center">Đơn giá</th>
                    <th class="text-center">Số lượng</th>
                    <th class="text-center">Thành tiền</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.Items)
                {
                    <tr>
                        <td class="text-center">
                            <input type="checkbox" class="select-item" name="selectedIds" value="@item.CartItemId" />
                        </td>
                        <input type="hidden" name="cartItemId" value="@item.CartItemId" />
                        <td class="text-center">
                            <img src="@item.Images" width="60" alt="@item.ProductName" />
                        </td>
                        <td class="text-center" name="productName">@item.ProductName</td>
                        <td class="text-center">@item.Price.ToString("N0") đ</td>
                        <td class="text-center">
                            <div class="d-inline-flex align-items-center">
                                <button type="submit" class="btn btn-sm btn-outline-secondary decrease">-</button>
                                <input type="text" class="form-control form-control-sm text-center mx-1" style="width: 50px;" value="@item.Quantity" name="quantity" />
                                <button type="submit" class="btn btn-sm btn-outline-secondary increase">+</button>
                            </div>
                        </td class="text-center">
                        <td class="text-center" name="total">@((item.Price * item.Quantity).ToString("N0")) đ</td>
                        <td class="text-center">
                                <button data-id="@item.CartItemId" type="submit" class="btn btn-sm btn-danger btn-delete-cart">Xoá</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
        <div class="mt-3">
            <button type="submit" formaction="/Carts/DeleteSelected" formmethod="post" class="btn btn-danger" id="delete-selected">Xoá các sản phẩm đã chọn</button>
        </div>  
        @* <a href="/Checkouts/"> *@
             <div class="text-right mt-4">
                <h4>Tổng cộng: <strong name="totalPrice">@totalPrice.ToString("N0") đ</strong></h4>
                <button type="submit" class="btn btn-success" style="margin-bottom: 5px;" id="checkout-btn">Thanh toán</button>
            </div>
        @* </a> *@
       
    }
</form>
<script>
    document.addEventListener("DOMContentLoaded", function () {
    const selectAll = document.getElementById("select-all");
    const checkboxes = document.querySelectorAll(".select-item");

    if (selectAll) {
        selectAll.addEventListener("change", function () {
            checkboxes.forEach(cb => cb.checked = this.checked);
        });
    }
});

</script>